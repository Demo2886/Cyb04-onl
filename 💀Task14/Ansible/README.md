# Выполняем задачу, используя Ansible.

## Шаги для применения конфигурации

1. **Убедитесь, что Ansible настроен и может подключаться к целевой системе**:
   - Проверьте соединение с целевым узлом, используя команду:

     ```bash
     ansible -i inventory.ini all -m ping
     ```

   Это проверит, что Ansible может подключиться к целевым узлам, используя инвентарный файл `inventory.ini`.

2. **Запустите Playbook**:
   - Выполните playbook, чтобы применить конфигурацию:

     ```bash
     ansible-playbook -i inventory.ini playbooks/password_policy.yml
     ```

   - Убедитесь, что в процессе выполнения не возникло ошибок. Все задачи должны быть помечены как `ok` или `changed`.

3. **Проверка изменений**:
   - **Проверка политики паролей**:
     - Проверьте файл `/etc/pam.d/common-password` на целевой системе, чтобы убедиться, что настройки применены.
     - Проверьте файл `/etc/login.defs` для подтверждения изменений в сроках действия паролей.

   - **Проверка SSH**:
     - Откройте файл `/etc/ssh/sshd_config` и убедитесь, что `PermitRootLogin no` установлен.
     - Попробуйте подключиться к системе как `root` по SSH, чтобы убедиться, что доступ запрещен.

### Структура проекта

```
ansible-project/
│
├── inventory.ini
├── ansible.cfg
└── playbooks/
    └── password_policy.yml
└── roles/
    └── password_policy/
        ├── tasks/
        │   └── main.yml
        ├── files/
        │   └── sshd_config
        ├── templates/
        │   └── common-password.j2
        └── vars/
            └── main.yml
```

#### Описание структуры:

- **inventory.ini**: Файл инвентаря, в котором перечислены управляющие серверы. Здесь указываются IP-адреса или хостнеймы целевых машин.
  
- **ansible.cfg**: Конфигурационный файл Ansible, где можно указать настройки по умолчанию, такие как путь к инвентарю, параметры подключения и т.д.

- **playbooks/**: Каталог, содержащий playbooks. В нашем случае это файл `password_policy.yml`, который будет запускать роль настройки политики паролей.

- **roles/password_policy/**: Структура роли, которая отвечает за настройку политики паролей.

  - **tasks/main.yml**: Основной файл задач, где прописаны шаги для установки и настройки политики паролей.

  - **files/sshd_config**: Конфигурационный файл SSH, который будет использоваться для отключения входа root по SSH.

  - **templates/common-password.j2**: Шаблон для настройки параметров `pam.d`.

  - **vars/main.yml**: Файл переменных, где сохраняются значения, такие как максимальная длина пароля, сложность и т.д.

#### Вывод результата:

``` bash

ansible-playbook -i inventory.ini playbooks/password_policy.yml

PLAY [Настройка политики паролей и SSH] ****************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host name-host is using the discovered Python interpreter at /usr/bin/python3.8, but future installation of another Python interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [name-host]

TASK [password_policy : Установить libpam-cracklib] ****************************************************************************************************************************************************************************
changed: [name-host]

TASK [password_policy : Настроить политику паролей в /etc/login.defs] **********************************************************************************************************************************************************
changed: [name-host] => (item={'key': 'PASS_MAX_DAYS', 'value': '90'})
changed: [name-host] => (item={'key': 'PASS_MIN_DAYS', 'value': '0'})
changed: [name-host] => (item={'key': 'PASS_WARN_AGE', 'value': '5'})

TASK [password_policy : Настроить политику сложности паролей в /etc/pam.d/common-password] *************************************************************************************************************************************
changed: [name-host]

TASK [password_policy : Отключить root вход по SSH] ****************************************************************************************************************************************************************************
changed: [name-host]

RUNNING HANDLER [password_policy : restart ssh] ********************************************************************************************************************************************************************************
changed: [name-host]

PLAY RECAP *********************************************************************************************************************************************************************************************************************
name-host                  : ok=6    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


```