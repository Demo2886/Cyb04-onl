# –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–¥–∞—á—É, –∏—Å–ø–æ–ª—å–∑—É—è Ansible.

## –®–∞–≥–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Ansible –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Ü–µ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Ü–µ–ª–µ–≤—ã–º —É–∑–ª–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É:

     ```bash
     ansible -i inventory.ini all -m ping
     ```

   –≠—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ Ansible –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ü–µ–ª–µ–≤—ã–º —É–∑–ª–∞–º, –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π —Ñ–∞–π–ª `inventory.ini`.

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Playbook**:
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ playbook, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

     ```bash
     ansible-playbook -i inventory.ini playbooks/password_policy.yml
     ```

   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ –≤–æ–∑–Ω–∏–∫–ª–æ –æ—à–∏–±–æ–∫. –í—Å–µ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `ok` –∏–ª–∏ `changed`.

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π**:
     - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `/etc/pam.d/common-password` –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.
     - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `/etc/login.defs` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ä–æ–∫–∞—Ö –¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä–æ–ª–µ–π.

![img](/üíÄTask14/img/pass.png)
![img](/üíÄTask14/img/pass-d.png)

   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ SSH**:
     - –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `/etc/ssh/sshd_config` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `PermitRootLogin no` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.
     - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–∏—Å—Ç–µ–º–µ –∫–∞–∫ `root` –ø–æ SSH, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.

![img](/üíÄTask14/img/ssh-no-root.png)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ansible-project/
‚îÇ
‚îú‚îÄ‚îÄ inventory.ini
‚îú‚îÄ‚îÄ ansible.cfg
‚îî‚îÄ‚îÄ playbooks/
    ‚îî‚îÄ‚îÄ password_policy.yml
‚îî‚îÄ‚îÄ roles/
    ‚îî‚îÄ‚îÄ password_policy/
        ‚îú‚îÄ‚îÄ tasks/
        ‚îÇ   ‚îî‚îÄ‚îÄ main.yml
        ‚îú‚îÄ‚îÄ files/
        ‚îÇ   ‚îî‚îÄ‚îÄ sshd_config
        ‚îú‚îÄ‚îÄ templates/
        ‚îÇ   ‚îî‚îÄ‚îÄ common-password.j2
        ‚îî‚îÄ‚îÄ vars/
            ‚îî‚îÄ‚îÄ main.yml
```

#### –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

- **inventory.ini**: –§–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–µ—Ä–≤–µ—Ä—ã. –ó–¥–µ—Å—å —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è IP-–∞–¥—Ä–µ—Å–∞ –∏–ª–∏ —Ö–æ—Å—Ç–Ω–µ–π–º—ã —Ü–µ–ª–µ–≤—ã—Ö –º–∞—à–∏–Ω.
  
- **ansible.cfg**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Ansible, –≥–¥–µ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç–∞–∫–∏–µ –∫–∞–∫ –ø—É—Ç—å –∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—é, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ —Ç.–¥.

- **playbooks/**: –ö–∞—Ç–∞–ª–æ–≥, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π playbooks. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ —Ñ–∞–π–ª `password_policy.yml`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–æ–ª—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π.

- **roles/password_policy/**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π.

  - **tasks/main.yml**: –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∑–∞–¥–∞—á, –≥–¥–µ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —à–∞–≥–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π.

  - **files/sshd_config**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª SSH, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤—Ö–æ–¥–∞ root –ø–æ SSH.

  - **templates/common-password.j2**: –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `pam.d`.

  - **vars/main.yml**: –§–∞–π–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –≥–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–∞–∫–∏–µ –∫–∞–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —Ç.–¥.

#### –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

``` bash

ansible-playbook -i inventory.ini playbooks/password_policy.yml

PLAY [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø–∞—Ä–æ–ª–µ–π –∏ SSH] ****************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host name-host is using the discovered Python interpreter at /usr/bin/python3.8, but future installation of another Python interpreter could change the meaning of that path. See
https://docs.ansible.com/ansible-core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [name-host]

TASK [password_policy : –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å libpam-cracklib] ****************************************************************************************************************************************************************************
changed: [name-host]

TASK [password_policy : –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –ø–∞—Ä–æ–ª–µ–π –≤ /etc/login.defs] **********************************************************************************************************************************************************
changed: [name-host] => (item={'key': 'PASS_MAX_DAYS', 'value': '90'})
changed: [name-host] => (item={'key': 'PASS_MIN_DAYS', 'value': '0'})
changed: [name-host] => (item={'key': 'PASS_WARN_AGE', 'value': '5'})

TASK [password_policy : –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª–µ–π –≤ /etc/pam.d/common-password] *************************************************************************************************************************************
changed: [name-host]

TASK [password_policy : –û—Ç–∫–ª—é—á–∏—Ç—å root –≤—Ö–æ–¥ –ø–æ SSH] ****************************************************************************************************************************************************************************
changed: [name-host]

RUNNING HANDLER [password_policy : restart ssh] ********************************************************************************************************************************************************************************
changed: [name-host]

PLAY RECAP *********************************************************************************************************************************************************************************************************************
name-host                  : ok=6    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


```