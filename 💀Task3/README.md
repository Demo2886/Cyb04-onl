# Домашняя работа.

## 0. update/upgrate KALI LINUX.

![Image](/Task3/img/upgrade-kali.png)
![Image](/Task3/img/SSH-kali.png)

## 1. На VM Win10/WinServer установить SSH Server и запустить его.

Чтобы установить и запустить SSH-сервер на Windows 10 или Windows Server, выполните следующие шаги:

### Установка OpenSSH Server

1. **Открытие настроек Windows:**
   - Нажмите `Win + I`, чтобы открыть настройки.

2. **Переход в раздел "Приложения":**
   - Выберите "Приложения" (Apps).

3. **Управление компонентами:**
   - В меню слева выберите "Дополнительные компоненты" (Optional features).
   - Нажмите на "Добавить компонент" (Add a feature).

4. **Поиск OpenSSH Server:**
   - В списке компонентов найдите "OpenSSH Server".
   - Установите его, нажав кнопку "Установить" (Install).

### Запуск OpenSSH Server

1. **Открытие PowerShell с правами администратора:**
   - Нажмите `Win`, введите `PowerShell`, щелкните правой кнопкой мыши и выберите "Запуск от имени администратора" (Run as administrator).

2. **Запуск службы SSH:**
   - Введите следующую команду для запуска службы:
     ```powershell
     Start-Service sshd
     ```

3. **Настройка автоматического запуска службы:**
   - Чтобы служба запускалась автоматически при загрузке системы, выполните команду:
     ```powershell
     Set-Service -Name sshd -StartupType 'Automatic'
     ```

### Проверка работы SSH-сервера

1. **Проверка состояния службы:**
   - Выполните команду:
     ```powershell
     Get-Service sshd
     ```
   - Убедитесь, что статус службы "Running".

2. **Настройка брандмауэра:**
   - Если у вас включен брандмауэр, убедитесь, что он разрешает входящие подключения на порт 22. Для этого выполните команду:
     ```powershell
     New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
     ```

Теперь ваш SSH-сервер должен быть установлен и запущен. Вы можете подключиться к нему с другого устройства, используя SSH-клиент.

![Image](/Task3/img/SSH-win10.png)
![Image](/Task3/img/SSH-win2019.png)

## 2. Разрешить подключение по RDP.

Чтобы разрешить подключение по RDP (Remote Desktop Protocol) на Windows 10 или Windows Server, выполните следующие шаги:

### Шаг 1: Включение удаленного рабочего стола

1. **Открытие настроек системы:**
   - Нажмите `Win + I`, чтобы открыть настройки.
   - Перейдите в раздел "Система" (System).

2. **Переход в раздел "Удаленный рабочий стол":**
   - В меню слева выберите "Удаленный рабочий стол" (Remote Desktop).

3. **Включение удаленного рабочего стола:**
   - Переключите тумблер "Включить удаленный рабочий стол" (Enable Remote Desktop) в положение "Включено" (On).
   - Подтвердите выбор, если появится соответствующий запрос.

### Шаг 2: Настройка брандмауэра

1. **Открытие PowerShell с правами администратора:**
   - Нажмите `Win`, введите `PowerShell`, щелкните правой кнопкой мыши и выберите "Запуск от имени администратора" (Run as administrator).

2. **Разрешение RDP в брандмауэре:**
   - Выполните следующую команду:
     ```powershell
     New-NetFirewallRule -Name "RDP" -DisplayName "Remote Desktop" -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 3389
     ```

### Шаг 3: Настройка пользователей

1. **Добавление пользователей для доступа:**
   - В разделе "Удаленный рабочий стол" (Remote Desktop) нажмите на "Выбрать пользователей, которые могут удаленно подключаться к этому компьютеру" (Select users that can remotely access this PC).
   - Нажмите "Добавить" (Add) и введите имя пользователя, которому хотите предоставить доступ.

### Шаг 4: Подключение к удаленному рабочему столу

Теперь вы можете подключиться к вашему компьютеру через RDP с другого устройства:

1. **Открытие приложения "Удаленный рабочий стол":**
   - На другом компьютере откройте приложение "Удаленный рабочий стол" (Remote Desktop Connection).
   - Введите IP-адрес или имя компьютера, к которому хотите подключиться.
   - Нажмите "Подключить" (Connect) и введите учетные данные пользователя.

После выполнения этих шагов вы сможете подключаться к вашему компьютеру по RDP.

![Image](/Task3/img/open-RDP.png)

## 3. Провести сканирование подсети с ВМ Kali

![Image](/Task3/img/nmap-win10.png)

## 4. Провести BruteForce (ssh) пароля от ВМ Win10

Проведение атаки с использованием brute-force на SSH с помощью Hydra может быть полезно для образовательных целей, однако важно помнить, что такие действия должны выполняться только на системах, для которых у вас есть разрешение. Вот общий процесс, как это сделать в Kali Linux для учебных целей:

### Установка Hydra

Если Hydra не установлена на вашем Kali Linux, вы можете установить её с помощью следующей команды:

```bash
sudo apt update
sudo apt install hydra
```

### Подготовка к атаке

1. **Убедитесь, что SSH-сервер запущен на Windows 10.**
2. **Определите IP-адрес вашей Windows 10.** Вы можете использовать команду `ipconfig` в командной строке Windows для получения IP-адреса.
3. **Создайте файл со списком паролей.** Например, создайте файл `passwords.txt` с паролями, которые вы хотите протестировать.

### Запуск атаки с помощью Hydra

Используйте следующую команду для запуска атаки:

```bash
hydra -l <username> -P <path_to_password_file> ssh://<target_ip>
```

Где:
- `<username>` — имя пользователя, к которому вы хотите получить доступ.
- `<path_to_password_file>` — путь к файлу со списком паролей (например, `passwords.txt`).
- `<target_ip>` — IP-адрес вашей Windows 10.

Пример команды:

```bash
hydra -l admin -P /path/to/passwords.txt ssh://192.168.1.10
```

### Примечания

- **Этика и законность:** Убедитесь, что у вас есть разрешение на выполнение таких тестов на целевой системе. Без разрешения это может считаться незаконным.
- **Результаты:** Hydra будет пытаться перебрать пароли из указанного файла. Если пароль будет найден, вы увидите сообщение о успешном входе.

### Завершение

По завершении тестирования убедитесь, что вы удалили все следы вашей активности и уведомили владельца системы о проведенном тестировании.

========================================================================

`Crunch` — это утилита для генерации словарей, которая может быть полезна в задачах по тестированию на проникновение, например, для создания списков паролей. Вот основные шаги по использованию `crunch` в Kali Linux или любой другой системе на базе Linux.

### Установка Crunch

В большинстве дистрибутивов Linux, включая Kali, `crunch` уже установлен. Если он не установлен, вы можете установить его с помощью следующей команды:

```bash
sudo apt update
sudo apt install crunch
```

### Основные параметры и использование

1. **Основной синтаксис:**

   ```bash
   crunch <min_length> <max_length> -o <output_file>
   ```

   - `<min_length>` — минимальная длина генерируемых паролей.
   - `<max_length>` — максимальная длина генерируемых паролей.
   - `<output_file>` — файл, в который будут записаны сгенерированные пароли.

2. **Пример генерации:**

   Если вы хотите сгенерировать пароли длиной от 4 до 6 символов и сохранить их в файл `passwords.txt`, используйте следующую команду:

   ```bash
   crunch 4 6 -o passwords.txt
   ```

3. **Использование символов:**

   Вы можете указать набор символов, из которых будут генерироваться пароли, с помощью параметра `-t`. Например, если вы хотите генерировать пароли, состоящие только из маленьких букв:

   ```bash
   crunch 4 6 -o passwords.txt -f /usr/share/crunch/charset.lst mixalpha
   ```

   Или вы можете указать собственный набор символов:

   ```bash
   crunch 4 6 -o passwords.txt -t @@@@ -s abcd
   ```

   Здесь `@@@@` указывает на то, что пароли будут состоять из 4 символов, а `-s abcd` задает начальную строку.

4. **Комбинирование с другими утилитами:**

   Вы можете использовать `crunch` в сочетании с другими инструментами, такими как `hydra`, для перебора паролей. Например:

   ```bash
   crunch 4 6 -o passwords.txt | hydra -l username -P - ssh://target_ip
   ```

5. **Дополнительные параметры:**

   - `-b <size>` — указывает размер файла для записи (например, `-b 100M` для 100 МБ).
   - `-p <pattern>` — генерирует пароли по заданному шаблону.

### Заключение

`Crunch` — это мощный инструмент для генерации словарей, который может быть настроен под конкретные нужды. Убедитесь, что вы используете его этично и в соответствии с законами вашей страны.

![Image](/Task3/img/scan-pass.png)


На FireWall Win10 разрешить подключение
по SSH только с VM WinServer.

## 5. На FireWall Win10 разрешить подключение по SSH только с VM WinServer.

Чтобы разрешить подключение по SSH на Windows 10 только с виртуальной машины Windows Server, вам нужно будет настроить брандмауэр Windows. Вот шаги, которые вам нужно выполнить:

### Шаг 1: Убедитесь, что SSH-сервер установлен на Windows 10

Если вы еще не установили SSH-сервер на Windows 10, вы можете сделать это через "Параметры" или "Диспетчер функций Windows":

1. Откройте "Параметры" (Windows + I).
2. Перейдите в "Приложения" > "Дополнительные компоненты".
3. Нажмите "Добавить компонент".
4. Найдите "OpenSSH Server" и установите его.

### Шаг 2: Настройка брандмауэра Windows

1. **Откройте брандмауэр Windows:**
   - Нажмите `Windows + R`, введите `wf.msc` и нажмите `Enter`.

2. **Создайте новое правило:**
   - В левой панели выберите "Правила для входящих подключений".
   - В правой панели нажмите "Создать правило...".

3. **Выберите тип правила:**
   - Выберите "Порт" и нажмите "Далее".

4. **Укажите порты:**
   - Выберите "TCP" и введите `22` в поле "Определенные локальные порты". Нажмите "Далее".

5. **Выберите действие:**
   - Выберите "Разрешить подключение" и нажмите "Далее".

6. **Укажите профиль:**
   - Выберите профили (Домен, Частный, Общедоступный), для которых будет применяться это правило, и нажмите "Далее".

7. **Назовите правило:**
   - Дайте правилу имя, например "SSH Access from WinServer", и нажмите "Готово".

### Шаг 3: Ограничение доступа по IP-адресу

Теперь вам нужно ограничить доступ только для IP-адреса вашей виртуальной машины Windows Server:

1. **Найдите IP-адрес вашей Windows Server:**
   - На Windows Server откройте командную строку и введите `ipconfig`, чтобы узнать IP-адрес.

2. **Вернитесь в брандмауэр Windows:**
   - Найдите созданное вами правило "SSH Access from WinServer".

3. **Измените правило:**
   - Щелкните правой кнопкой мыши на правиле и выберите "Свойства".
   - Перейдите на вкладку "Области".

4. **Настройка области:**
   - В разделе "Удаленные IP-адреса" выберите "Эти IP-адреса" и добавьте IP-адрес вашей Windows Server.
   - Нажмите "ОК", чтобы сохранить изменения.

### Шаг 4: Тестирование подключения

Теперь вы можете протестировать подключение по SSH с вашей виртуальной машины Windows Server к Windows 10. Подключение должно успешно проходить, если вы используете указанный IP-адрес, а все остальные подключения должны быть заблокированы.

### Примечания

- Убедитесь, что у вас есть все необходимые права для внесения изменений в настройки брандмауэра.
- Если ваша Windows Server использует динамический IP-адрес, вам может понадобиться настроить статический IP-адрес или использовать DHCP-резервирование, чтобы IP-адрес не изменялся.

![Image](/Task3/img/SSH%20Access%20from%20WinServer.png)


## 6. Настроить в политиках блокировки УЗ блокировку на 5 мин после 7 не удачных попыток.

Чтобы настроить политику блокировки учетной записи в Windows, следуйте этим шагам:

### Шаг 1: Открытие редактора локальной групповой политики

1. Нажмите `Win + R`, чтобы открыть окно "Выполнить".
2. Введите `gpedit.msc` и нажмите `Enter`. Это откроет редактор локальной групповой политики.

### Шаг 2: Настройка политики блокировки учетной записи

1. Перейдите по следующему пути:
   ```
   Конфигурация компьютера -> Настройки Windows -> Параметры безопасности -> Политики локального компьютера -> Политики учетных записей -> Политика блокировки учетной записи
   ```

2. Найдите следующие параметры и настройте их:

   - **"Количество неудачных попыток входа"** (Account lockout threshold):
     - Дважды щелкните на этот параметр и установите значение `7` (неудачных попыток).
     - Нажмите "ОК".

   - **"Время блокировки учетной записи"** (Account lockout duration):
     - Дважды щелкните на этот параметр и установите значение `5` (минут).
     - Нажмите "ОК".

   - **"Время сброса счетчика блокировок"** (Reset account lockout counter after):
     - Дважды щелкните на этот параметр и установите значение, например, `5` (минут) или любое другое, если хотите.
     - Нажмите "ОК".

### Шаг 3: Применение изменений

После того как вы внесли изменения, закройте редактор локальной групповой политики. Политики будут применены автоматически.

### Шаг 4: Проверка настроек

Вы можете проверить настройки, выполнив следующие команды в PowerShell или командной строке с правами администратора:

```powershell
secedit /export /cfg C:\secpol.cfg
```

Затем откройте файл `C:\secpol.cfg` и найдите соответствующие параметры.

Теперь ваша система будет блокировать учетные записи на 5 минут после 7 неудачных попыток входа.

![Image](/Task3/img/polici-bloc.png)


